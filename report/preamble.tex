\DocumentMetadata{
    pdfversion=2.0,
    pdfstandard=A-4,
    pdfstandard=UA-2,
    lang=en,
}

\documentclass[
  overfullrule,
  fontsize=12,
]{scrbook}

\usepackage[l2tabu,orthodox]{nag}

\usepackage{polyglossia}
\setdefaultlanguage{english}

\usepackage{mathtools} % amssymb
\usepackage{mleftright}
\mleftright

\usepackage{fontspec}
\usepackage[warnings-off={mathtools-colon,mathtools-overbracket}]{unicode-math}
\defaultfontfeatures{Ligatures=TeX}

\setmainfont{TeX Gyre Pagella}
\setsansfont{TeX Gyre Heros}
% ~/.cache/texlive/texmf-var/luatex-cache/generic/names/luaotfload-names.lua.gz
\directlua{luaotfload.add_fallback("monofb", {
    % "firacode:mode=node",
    % "notosansmono:mode=node;"
    "freemono:mode=node;",
    "texgyrepagellamath:mode=node;",
    % "unifont:mode=node;"
})}
\setmonofont[RawFeature={fallback=monofb},Scale=MatchLowercase,Ligatures=TeXOff]{Inconsolata LGC}
\setmathfont{Tex Gyre Pagella Math}

% \setmainfont{Libertinus Serif}
% \setsansfont{Libertinus Sans}
% \setmonofont{Libertinus Mono}
% \setmonofont[Instance=Regular]{Fira Code}

\usepackage{microtype}
% \frenchspacing

% \usepackage[strict=true]{csquotes}
\usepackage[
  backend=biber,
  bibencoding=utf-8,
  safeinputenc,
  bibwarn=true,
  style=numeric, %alphabetic,
  maxnames=100,
  alldates=iso,
]{biblatex}
\addbibresource{bibliography.bib}

\usepackage{listings}
\lstset{
  basicstyle=\ttfamily\lst@ifdisplaystyle\small\fi,
  columns=fullflexible,
  keepspaces=true,
  captionpos=b,
}
\lstdefinelanguage{sail}{
  morekeywords={
    val,function,let,in,match,if,then,else,register,enum,mapping,bitfield,
    union,clause,scattered,
    bool,int,bits,range,vector,
    unsigned
  },
  morecomment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]",
}
\lstdefinelanguage{asm}{}

\makeatletter
\newcommand{\currentfontsize}{\fontsize{\f@size}{\f@baselineskip}\selectfont}
\makeatother

\usepackage[newfloat]{minted}
\setminted{fontsize=\small}
\setmintedinline{fontsize=\currentfontsize}
\removefromtoclist[float]{lol} % https://github.com/gpoore/minted/issues/390

\usepackage{float,caption}
\floatstyle{ruled}
\restylefloat{listing}
\captionsetup[listing]{font=small}

% adjust space around rules in ruled floats by redefining \fs@ruled from float.sty
\makeatletter
\renewcommand\fs@ruled{\def\@fs@cfont{\bfseries}\let\@fs@capt\floatc@ruled
  \def\@fs@pre{\hrule height.8pt depth0pt \kern2pt\vskip0.1\baselineskip}%
  \def\@fs@post{\vskip-0.7\baselineskip\kern2pt\hrule\relax}%
  \def\@fs@mid{\kern2pt\hrule\kern2pt\vskip0.2\baselineskip}%
  \let\@fs@iftopcapt\iftrue}
\makeatother

\usepackage{graphicx}
\graphicspath{{img/}}

\usepackage{booktabs}

\usepackage{tikz}
\usetikzlibrary{graphs,graphdrawing}
\usegdlibrary{layered}

\input{macros.tex}

\usepackage[hidelinks,unicode]{hyperref} % backref
\usepackage[noabbrev,capitalize]{cleveref}

% \usepackage{lua-visual-debug}
